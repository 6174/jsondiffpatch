/*
*   Json Diff Patch
*   ---------------
*   https://github.com/benjamine/JsonDiffPatch
*   by Benjamin Eidelman - beneidel@gmail.com
*/(function(){"use strict";var e={};typeof jsondiffpatch!="undefined"&&(e=jsondiffpatch),e.config={textDiffMinLength:60};var t={diff:function(e,t,n,r){var i=0,s=0,o,u,a=e.length,f=t.length,l,c=typeof n=="function"?function(e,t){return e===t?!0:typeof e!="object"||typeof t!="object"?!1:n(e)===n(t)}:function(e,t){return e===t},h=function(n,i){if(!r)return;if(typeof e[n]!="object"||typeof t[i]!="object")return;var s=r(e[n],t[i]);if(typeof s=="undefined")return;l||(l={_t:"a"}),l[i]=s};while(i<a&&i<f&&c(e[i],t[i]))h(i,i),i++;while(s+i<a&&s+i<f&&c(e[a-1-s],t[f-1-s]))h(a-1-s,f-1-s),s++;if(i+s===a){if(a===f)return l;l=l||{_t:"a"};for(o=i;o<f-s;o++)l[o]=[t[o]];return l}if(i+s===f){l=l||{_t:"a"};for(o=i;o<a-s;o++)l["_"+o]=[e[o],0,0];return l}var p=this.lcs(e.slice(i,a-s),t.slice(i,f-s),c);l=l||{_t:"a"};var d=[];for(o=i;o<a-s;o++)p.indices1.indexOf(o-i)<0&&(l["_"+o]=[e[o],0,0],d.push(o));var v=d.length;for(o=i;o<f-s;o++){var m=p.indices2.indexOf(o-i);if(m<0){var g=!1;if(v>0)for(u=0;u<v;u++)if(c(e[d[u]],t[o])){l["_"+d[u]].splice(1,2,o,3),h(d[u],o),d.splice(u,1),g=!0;break}g||(l[o]=[t[o]])}else h(p.indices1[m]+i,p.indices2[m]+i)}return l},getArrayIndexBefore:function(e,t){var n,i=t;for(var s in e)if(e.hasOwnProperty(s)&&r(e[s])){s.slice(0,1)==="_"?n=parseInt(s.slice(1),10):n=parseInt(s,10);if(e[s].length===1){if(n<t)i--;else if(n===t)return-1}else if(e[s].length===3)if(e[s][2]===0)n<=t&&i++;else if(e[s][2]===3){n<=t&&i++;if(e[s][1]>t)i--;else if(e[s][1]===t)return n}}return i},patch:function(e,t,n,r){var i,s,o=function(e,t){return e-t},u=function(e){return function(t,n){return t[e]-n[e]}},a=[],f=[],l=[];for(i in t)if(i!=="_t")if(i[0]=="_"){if(t[i][2]!==0&&t[i][2]!==3)throw new Error("only removal or move can be applied at original array indices, invalid diff type: "+t[i][2]);a.push(parseInt(i.slice(1),10))}else t[i].length===1?f.push({index:parseInt(i,10),value:t[i][0]}):l.push({index:parseInt(i,10),diff:t[i]});a=a.sort(o);for(i=a.length-1;i>=0;i--){s=a[i];var c=t["_"+s],h=e.splice(s,1)[0];c[2]===3&&f.push({index:c[1],value:h})}f=f.sort(u("index"));var p=f.length;for(i=0;i<p;i++){var d=f[i];e.splice(d.index,0,d.value)}var v=l.length;if(v>0){if(typeof n!="function")throw new Error("to patch items in the array an objectInnerPatch function must be provided");for(i=0;i<v;i++){var m=l[i];n(e,m.index.toString(),m.diff,r)}}return e},lcs:function(e,t,n){var r=this.lengthMatrix(e,t,n||function(e,t){return e===t}),i=this.backtrack(r,e,t,e.length,t.length);return typeof e=="string"&&typeof t=="string"&&(i.sequence=i.sequence.join("")),i},lengthMatrix:function(e,t,n){var r=e.length,i=t.length,s,o,u=[r+1];for(s=0;s<r+1;s++){u[s]=[i+1];for(o=0;o<i+1;o++)u[s][o]=0}for(s=1;s<r+1;s++)for(o=1;o<i+1;o++)n(e[s-1],t[o-1])?u[s][o]=u[s-1][o-1]+1:u[s][o]=Math.max(u[s-1][o],u[s][o-1]);return u.areTheSame=n,u},backtrack:function(e,t,n,r,i){if(r===0||i===0)return{sequence:[],indices1:[],indices2:[]};if(e.areTheSame(t[r-1],n[i-1])){var s=this.backtrack(e,t,n,r-1,i-1);return s.sequence.push(t[r-1]),s.indices1.push(r-1),s.indices2.push(i-1),s}return e[r][i-1]>e[r-1][i]?this.backtrack(e,t,n,r,i-1):this.backtrack(e,t,n,r-1,i)}};e.sequenceDiffer=t,e.dateReviver=function(e,t){var n;if(typeof t=="string"){n=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2}(?:\.\d*)?)(Z|([+\-])(\d{2}):(\d{2}))$/.exec(t);if(n)return new Date(Date.UTC(+n[1],+n[2]-1,+n[3],+n[4],+n[5],+n[6]))}return t};var n=function(){var t;e.config.diff_match_patch&&(t=new e.config.diff_match_patch.diff_match_patch),typeof diff_match_patch!="undefined"&&(typeof diff_match_patch=="function"?t=new diff_match_patch:typeof diff_match_patch=="object"&&typeof diff_match_patch.diff_match_patch=="function"&&(t=new diff_match_patch.diff_match_patch));if(t)return e.config.textDiff=function(e,n){return t.patch_toText(t.patch_make(e,n))},e.config.textPatch=function(e,n){var r=t.patch_apply(t.patch_fromText(n),e);for(var i=0;i<r[1].length;i++)if(!r[1][i])throw new Error("text patch failed");return r[0]},!0},r=e.isArray=typeof Array.isArray=="function"?Array.isArray:function(e){return typeof e=="object"&&e instanceof Array},i=e.isDate=function(e){return e instanceof Date||Object.prototype.toString.call(e)==="[object Date]"},s=function(n,r){return t.diff(n,r,e.config.objectHash,jsondiffpatch.diff)},o=function(e,t){var n,r,i,s;s=function(i){r=u(e[i],t[i]),typeof r!="undefined"&&(typeof n=="undefined"&&(n={}),n[i]=r)};for(i in t)t.hasOwnProperty(i)&&s(i);for(i in e)e.hasOwnProperty(i)&&typeof t[i]=="undefined"&&s(i);return n},u=e.diff=function(t,u){var a,f,l,c,h;if(t===u)return;if(t!==t&&u!==u)return;a=typeof u,f=typeof t,l=u===null,c=t===null,f=="object"&&i(t)&&(f="date");if(a=="object"&&i(u)){a="date";if(f=="date"&&t.getTime()===u.getTime())return}if(l||c||a=="undefined"||a!=f||a=="number"||f=="number"||a=="boolean"||f=="boolean"||a=="string"||f=="string"||a=="date"||f=="date"||a==="object"&&r(u)!=r(t)){h=[];if(typeof t!="undefined")if(typeof u!="undefined"){var p=a=="string"&&f=="string"&&Math.min(t.length,u.length)>e.config.textDiffMinLength;p&&!e.config.textDiff&&n(),p&&e.config.textDiff?h.push(e.config.textDiff(t,u),0,2):(h.push(t),h.push(u))}else h.push(t),h.push(0,0);else h.push(u);return h}return r(u)?s(t,u):o(t,u)},a=function(e,t){return r(e)?e[parseInt(t,10)]:e[t]};e.getByKey=a;var f=function(e,t,n){if(r(e)&&e._key){var i=e._key;typeof e._key!="function"&&(i=function(t){return t[e._key]});for(var s=0;s<e.length;s++)if(i(e[s])===t){typeof n=="undefined"?(e.splice(s,1),s--):e[s]=n;return}typeof n!="undefined"&&e.push(n);return}typeof n=="undefined"?r(e)?e.splice(t,1):delete e[t]:e[t]=n},l=function(t){return e.config.textDiffReverse||(e.config.textDiffReverse=function(e){var t,n,r,i,s,o=null,u=/^@@ +\-(\d+),(\d+) +\+(\d+),(\d+) +@@$/,a,f,l,c=function(){f!==null&&(r[f]="-"+r[f].slice(1)),l!==null&&(r[l]="+"+r[l].slice(1),f!==null&&(s=r[f],r[f]=r[l],r[l]=s)),r[a]="@@ -"+o[3]+","+o[4]+" +"+o[1]+","+o[2]+" @@",o=null,a=null,f=null,l=null};r=e.split("\n");for(t=0,n=r.length;t<n;t++){i=r[t];var h=i.slice(0,1);h==="@"?(o!==null,o=u.exec(i),a=t,f=null,l=null,r[a]="@@ -"+o[3]+","+o[4]+" +"+o[1]+","+o[2]+" @@"):h=="+"?(f=t,r[t]="-"+r[t].slice(1)):h=="-"&&(l=t,r[t]="+"+r[t].slice(1))}return o!==null,r.join("\n")}),e.config.textDiffReverse(t)},c=e.reverse=function(e){var n,s;if(typeof e=="undefined")return;if(e===null)return null;if(typeof e=="object"&&!i(e)){if(r(e)){if(e.length<3)return e.length===1?[e[0],0,0]:[e[1],e[0]];if(e[2]===0)return[e[0]];if(e[2]===2)return[l(e[0]),0,2];throw new Error("invalid diff type")}s={};if(e._t==="a"){for(n in e)if(e.hasOwnProperty(n)&&n!=="_t"){var o,u=n;n.slice(0,1)==="_"?o=parseInt(n.slice(1),10):o=parseInt(n,10);if(r(e[n]))if(e[n].length===1)u="_"+o;else if(e[n].length===2)u=t.getArrayIndexBefore(e,o);else if(e[n][2]===0)u=o.toString();else{if(e[n][2]===3){u="_"+e[n][1],s[u]=[e[n][0],o,3];continue}u=t.getArrayIndexBefore(e,o)}else u=t.getArrayIndexBefore(e,o);s[u]=c(e[n])}s._t="a"}else for(n in e)e.hasOwnProperty(n)&&(s[n]=c(e[n]));return s}return typeof e=="string"&&e.slice(0,2)==="@@"?l(e):e},h=e.patch=function(i,s,o,u){var l,c,p="",d;typeof s!="string"?(u=o,o=s,s=null):typeof i!="object"&&(s=null),u&&(p+=u),p+="/",s!==null&&(p+=s);if(typeof o=="object")if(r(o)){if(o.length<3)return c=o[o.length-1],s!==null&&f(i,s,c),c;if(o[2]!==0){if(o[2]===2){e.config.textPatch||n();if(!e.config.textPatch)throw new Error("textPatch function not found");try{c=e.config.textPatch(a(i,s),o[0])}catch(v){throw new Error('cannot apply patch at "'+p+'": '+v)}return s!==null&&f(i,s,c),c}throw o[2]===3?new Error("Not implemented diff type: "+o[2]):new Error("invalid diff type: "+o[2])}if(s===null)return;f(i,s)}else if(o._t=="a"){d=s===null?i:a(i,s);if(typeof d!="object"||!r(d))throw new Error('cannot apply patch at "'+p+'": array expected');t.patch(d,o,jsondiffpatch.patch,p)}else{d=s===null?i:a(i,s);if(typeof d!="object"||r(d))throw new Error('cannot apply patch at "'+p+'": object expected');for(l in o)o.hasOwnProperty(l)&&h(d,l,o[l],p)}return i},p=e.unpatch=function(e,t,n,r){return typeof t!="string"?h(e,c(t),n):h(e,t,c(n),r)};typeof require=="function"&&typeof exports=="object"&&typeof module=="object"?module.exports=e:typeof define=="function"&&define.amd?define(e):window.jsondiffpatch=e})();